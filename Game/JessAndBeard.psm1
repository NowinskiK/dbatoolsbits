#region words
$ShallWePLayAGame = @"

  _____ _           _ _  __          __    _____  _                           _____                     ___  
 / ____| |         | | | \ \        / /   |  __ \| |                 /\      / ____|                   |__ \ 
| (___ | |__   __ _| | |  \ \  /\  / /__  | |__) | | __ _ _   _     /  \    | |  __  __ _ _ __ ___   ___  ) |
 \___ \| '_ \ / _` | | |   \ \/  \/ / _ \ |  ___/| |/ _` | | | |   / /\ \   | | |_ |/ _` | '_ ` _ \ / _ \/ / 
 ____) | | | | (_| | | |    \  /\  /  __/ | |    | | (_| | |_| |  / ____ \  | |__| | (_| | | | | | |  __/_|  
|_____/|_| |_|\__,_|_|_|     \/  \/ \___| |_|    |_|\__,_|\__, | /_/    \_\  \_____|\__,_|_| |_| |_|\___(_)  
                                                           __/ |                                             
                                                          |___/                                              
"@
#ANSI Shadow https://patorjk.com/software/taag/#p=testall&f=Doom&t=Shall%20We%20Play%20A%20Game%3F
$ShallWePLayAGame = @"

 ███████╗██╗  ██╗ █████╗ ██╗     ██╗         ██╗    ██╗███████╗    ██████╗ ██╗      █████╗ ██╗   ██╗     █████╗      ██████╗  █████╗ ███╗   ███╗███████╗██████╗ 
 ██╔════╝██║  ██║██╔══██╗██║     ██║         ██║    ██║██╔════╝    ██╔══██╗██║     ██╔══██╗╚██╗ ██╔╝    ██╔══██╗    ██╔════╝ ██╔══██╗████╗ ████║██╔════╝╚════██╗
 ███████╗███████║███████║██║     ██║         ██║ █╗ ██║█████╗      ██████╔╝██║     ███████║ ╚████╔╝     ███████║    ██║  ███╗███████║██╔████╔██║█████╗    ▄███╔╝
 ╚════██║██╔══██║██╔══██║██║     ██║         ██║███╗██║██╔══╝      ██╔═══╝ ██║     ██╔══██║  ╚██╔╝      ██╔══██║    ██║   ██║██╔══██║██║╚██╔╝██║██╔══╝    ▀▀══╝ 
 ███████║██║  ██║██║  ██║███████╗███████╗    ╚███╔███╔╝███████╗    ██║     ███████╗██║  ██║   ██║       ██║  ██║    ╚██████╔╝██║  ██║██║ ╚═╝ ██║███████╗  ██╗   
 ╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝╚══════╝     ╚══╝╚══╝ ╚══════╝    ╚═╝     ╚══════╝╚═╝  ╚═╝   ╚═╝       ╚═╝  ╚═╝     ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝╚══════╝  ╚═╝   
                                                                                                                                                                
 
"@

$OhNo1 = @"
██████  ██░ ██  ▄▄▄       ██▓     ██▓        █     █░▓█████     ██▓███   ██▓    ▄▄▄     ▓██   ██▓    ▄▄▄           ▄████  ▄▄▄       ███▄ ▄███▓▓█████ 
▒██    ▒ ▓██░ ██▒▒████▄    ▓██▒    ▓██▒       ▓█░ █ ░█░▓█   ▀    ▓██░  ██▒▓██▒   ▒████▄    ▒██  ██▒   ▒████▄        ██▒ ▀█▒▒████▄    ▓██▒▀█▀ ██▒▓█   ▀ 
░ ▓██▄   ▒██▀▀██░▒██  ▀█▄  ▒██░    ▒██░       ▒█░ █ ░█ ▒███      ▓██░ ██▓▒▒██░   ▒██  ▀█▄   ▒██ ██░   ▒██  ▀█▄     ▒██░▄▄▄░▒██  ▀█▄  ▓██    ▓██░▒███   
  ▒   ██▒░▓█ ░██ ░██▄▄▄▄██ ▒██░    ▒██░       ░█░ █ ░█ ▒▓█  ▄    ▒██▄█▓▒ ▒▒██░   ░██▄▄▄▄██  ░ ▐██▓░   ░██▄▄▄▄██    ░▓█  ██▓░██▄▄▄▄██ ▒██    ▒██ ▒▓█  ▄ 
▒██████▒▒░▓█▒░██▓ ▓█   ▓██▒░██████▒░██████▒   ░░██▒██▓ ░▒████▒   ▒██▒ ░  ░░██████▒▓█   ▓██▒ ░ ██▒▓░    ▓█   ▓██▒   ░▒▓███▀▒ ▓█   ▓██▒▒██▒   ░██▒░▒████▒
▒ ▒▓▒ ▒ ░ ▒ ░░▒░▒ ▒▒   ▓▒█░░ ▒░▓  ░░ ▒░▓  ░   ░ ▓░▒ ▒  ░░ ▒░ ░   ▒▓▒░ ░  ░░ ▒░▓  ░▒▒   ▓▒█░  ██▒▒▒     ▒▒   ▓▒█░    ░▒   ▒  ▒▒   ▓▒█░░ ▒░   ░  ░░░ ▒░ ░
░ ░▒  ░ ░ ▒ ░▒░ ░  ▒   ▒▒ ░░ ░ ▒  ░░ ░ ▒  ░     ▒ ░ ░   ░ ░  ░   ░▒ ░     ░ ░ ▒  ░ ▒   ▒▒ ░▓██ ░▒░      ▒   ▒▒ ░     ░   ░   ▒   ▒▒ ░░  ░      ░ ░ ░  ░
░  ░  ░   ░  ░░ ░  ░   ▒     ░ ░     ░ ░        ░   ░     ░      ░░         ░ ░    ░   ▒   ▒ ▒ ░░       ░   ▒      ░ ░   ░   ░   ▒   ░      ░      ░   
      ░   ░  ░  ░      ░  ░    ░  ░    ░  ░       ░       ░  ░                ░  ░     ░  ░░ ░              ░  ░         ░       ░  ░       ░      ░  ░
                                                                                           ░ ░                                                         
"@

$OhNo2 = @"

▄████  ▒█████   ▒█████  ▓█████▄     ▄▄▄▄ ▓██   ██▓▓█████ 
██▒ ▀█▒▒██▒  ██▒▒██▒  ██▒▒██▀ ██▌   ▓█████▄▒██  ██▒▓█   ▀ 
▒██░▄▄▄░▒██░  ██▒▒██░  ██▒░██   █▌   ▒██▒ ▄██▒██ ██░▒███   
░▓█  ██▓▒██   ██░▒██   ██░░▓█▄   ▌   ▒██░█▀  ░ ▐██▓░▒▓█  ▄ 
░▒▓███▀▒░ ████▓▒░░ ████▓▒░░▒████▓    ░▓█  ▀█▓░ ██▒▓░░▒████▒
░▒   ▒ ░ ▒░▒░▒░ ░ ▒░▒░▒░  ▒▒▓  ▒    ░▒▓███▀▒ ██▒▒▒ ░░ ▒░ ░
 ░   ░   ░ ▒ ▒░   ░ ▒ ▒░  ░ ▒  ▒    ▒░▒   ░▓██ ░▒░  ░ ░  ░
░ ░   ░ ░ ░ ░ ▒  ░ ░ ░ ▒   ░ ░  ░     ░    ░▒ ▒ ░░     ░   
     ░     ░ ░      ░ ░     ░        ░     ░ ░        ░  ░
                          ░               ░░ ░            
▄▄▄█████▓ ██░ ██ ▓█████    ▓█████  ███▄    █ ▓█████▄       
▓  ██▒ ▓▒▓██░ ██▒▓█   ▀    ▓█   ▀  ██ ▀█   █ ▒██▀ ██▌      
▒ ▓██░ ▒░▒██▀▀██░▒███      ▒███   ▓██  ▀█ ██▒░██   █▌      
░ ▓██▓ ░ ░▓█ ░██ ▒▓█  ▄    ▒▓█  ▄ ▓██▒  ▐▌██▒░▓█▄   ▌      
 ▒██▒ ░ ░▓█▒░██▓░▒████▒   ░▒████▒▒██░   ▓██░░▒████▓       
 ▒ ░░    ▒ ░░▒░▒░░ ▒░ ░   ░░ ▒░ ░░ ▒░   ▒ ▒  ▒▒▓  ▒       
   ░     ▒ ░▒░ ░ ░ ░  ░    ░ ░  ░░ ░░   ░ ▒░ ░ ▒  ▒       
 ░       ░  ░░ ░   ░         ░      ░   ░ ░  ░ ░  ░       
         ░  ░  ░   ░  ░      ░  ░         ░    ░          
                                             ░            

"@
$ChooseYourgame = @"

██████ ██   ██  ██████   ██████  ███████ ███████     ██    ██  ██████  ██    ██ ██████       ██████   █████  ███    ███ ███████              
██      ██   ██ ██    ██ ██    ██ ██      ██           ██  ██  ██    ██ ██    ██ ██   ██     ██       ██   ██ ████  ████ ██          ██       
██      ███████ ██    ██ ██    ██ ███████ █████         ████   ██    ██ ██    ██ ██████      ██   ███ ███████ ██ ████ ██ █████          █████ 
██      ██   ██ ██    ██ ██    ██      ██ ██             ██    ██    ██ ██    ██ ██   ██     ██    ██ ██   ██ ██  ██  ██ ██          ██       
 ██████ ██   ██  ██████   ██████  ███████ ███████        ██     ██████   ██████  ██   ██      ██████  ██   ██ ██      ██ ███████              
"@
$wrongChoice = @"

█     █░ ██▀███   ▒█████   ███▄    █   ▄████ 
▓█░ █ ░█░▓██ ▒ ██▒▒██▒  ██▒ ██ ▀█   █  ██▒ ▀█▒
▒█░ █ ░█ ▓██ ░▄█ ▒▒██░  ██▒▓██  ▀█ ██▒▒██░▄▄▄░
░█░ █ ░█ ▒██▀▀█▄  ▒██   ██░▓██▒  ▐▌██▒░▓█  ██▓
░░██▒██▓ ░██▓ ▒██▒░ ████▓▒░▒██░   ▓██░░▒▓███▀▒
░ ▓░▒ ▒  ░ ▒▓ ░▒▓░░ ▒░▒░▒░ ░ ▒░   ▒ ▒  ░▒   ▒ 
  ▒ ░ ░    ░▒ ░ ▒░  ░ ▒ ▒░ ░ ░░   ░ ▒░  ░   ░ 
  ░   ░    ░░   ░ ░ ░ ░ ▒     ░   ░ ░ ░ ░   ░ 
    ░       ░         ░ ░           ░       ░ 
                                              
 ▄████▄   ██░ ██  ▒█████   ██▓ ▄████▄  ▓█████ 
▒██▀ ▀█  ▓██░ ██▒▒██▒  ██▒▓██▒▒██▀ ▀█  ▓█   ▀ 
▒▓█    ▄ ▒██▀▀██░▒██░  ██▒▒██▒▒▓█    ▄ ▒███   
▒▓▓▄ ▄██▒░▓█ ░██ ▒██   ██░░██░▒▓▓▄ ▄██▒▒▓█  ▄ 
▒ ▓███▀ ░░▓█▒░██▓░ ████▓▒░░██░▒ ▓███▀ ░░▒████▒
░ ░▒ ▒  ░ ▒ ░░▒░▒░ ▒░▒░▒░ ░▓  ░ ░▒ ▒  ░░░ ▒░ ░
  ░  ▒    ▒ ░▒░ ░  ░ ▒ ▒░  ▒ ░  ░  ▒    ░ ░  ░
░         ░  ░░ ░░ ░ ░ ▒   ▒ ░░           ░   
░ ░       ░  ░  ░    ░ ░   ░  ░ ░         ░  ░
░                             ░               
"@
$Global:allofTheThings = @"
 ▄▄▄       ██▓     ██▓        ▒█████    █████▒   ▄▄▄█████▓ ██░ ██ ▓█████    
▒████▄    ▓██▒    ▓██▒       ▒██▒  ██▒▓██   ▒    ▓  ██▒ ▓▒▓██░ ██▒▓█   ▀    
▒██  ▀█▄  ▒██░    ▒██░       ▒██░  ██▒▒████ ░    ▒ ▓██░ ▒░▒██▀▀██░▒███      
░██▄▄▄▄██ ▒██░    ▒██░       ▒██   ██░░▓█▒  ░    ░ ▓██▓ ░ ░▓█ ░██ ▒▓█  ▄    
 ▓█   ▓██▒░██████▒░██████▒   ░ ████▓▒░░▒█░         ▒██▒ ░ ░▓█▒░██▓░▒████▒   
 ▒▒   ▓▒█░░ ▒░▓  ░░ ▒░▓  ░   ░ ▒░▒░▒░  ▒ ░         ▒ ░░    ▒ ░░▒░▒░░ ▒░ ░   
  ▒   ▒▒ ░░ ░ ▒  ░░ ░ ▒  ░     ░ ▒ ▒░  ░             ░     ▒ ░▒░ ░ ░ ░  ░   
  ░   ▒     ░ ░     ░ ░      ░ ░ ░ ▒   ░ ░         ░       ░  ░░ ░   ░      
      ░  ░    ░  ░    ░  ░       ░ ░                       ░  ░  ░   ░  ░   
                                                                            
            ▄▄▄█████▓ ██░ ██  ██▓ ███▄    █   ▄████   ██████                
            ▓  ██▒ ▓▒▓██░ ██▒▓██▒ ██ ▀█   █  ██▒ ▀█▒▒██    ▒                
            ▒ ▓██░ ▒░▒██▀▀██░▒██▒▓██  ▀█ ██▒▒██░▄▄▄░░ ▓██▄                  
            ░ ▓██▓ ░ ░▓█ ░██ ░██░▓██▒  ▐▌██▒░▓█  ██▓  ▒   ██▒               
              ▒██▒ ░ ░▓█▒░██▓░██░▒██░   ▓██░░▒▓███▀▒▒██████▒▒               
              ▒ ░░    ▒ ░░▒░▒░▓  ░ ▒░   ▒ ▒  ░▒   ▒ ▒ ▒▓▒ ▒ ░               
                ░     ▒ ░▒░ ░ ▒ ░░ ░░   ░ ▒░  ░   ░ ░ ░▒  ░ ░               
              ░       ░  ░░ ░ ▒ ░   ░   ░ ░ ░ ░   ░ ░  ░  ░                 
                      ░  ░  ░ ░           ░       ░       ░                 
                                                                            
"@

$Global:Italwaysis = @"

██▓▄▄▄█████▓  ██████     ▄▄▄       ██▓     █     █░ ▄▄▄     ▓██   ██▓  ██████    
▓██▒▓  ██▒ ▓▒▒██    ▒    ▒████▄    ▓██▒    ▓█░ █ ░█░▒████▄    ▒██  ██▒▒██    ▒    
▒██▒▒ ▓██░ ▒░░ ▓██▄      ▒██  ▀█▄  ▒██░    ▒█░ █ ░█ ▒██  ▀█▄   ▒██ ██░░ ▓██▄      
░██░░ ▓██▓ ░   ▒   ██▒   ░██▄▄▄▄██ ▒██░    ░█░ █ ░█ ░██▄▄▄▄██  ░ ▐██▓░  ▒   ██▒   
░██░  ▒██▒ ░ ▒██████▒▒    ▓█   ▓██▒░██████▒░░██▒██▓  ▓█   ▓██▒ ░ ██▒▓░▒██████▒▒   
░▓    ▒ ░░   ▒ ▒▓▒ ▒ ░    ▒▒   ▓▒█░░ ▒░▓  ░░ ▓░▒ ▒   ▒▒   ▓▒█░  ██▒▒▒ ▒ ▒▓▒ ▒ ░   
 ▒ ░    ░    ░ ░▒  ░ ░     ▒   ▒▒ ░░ ░ ▒  ░  ▒ ░ ░    ▒   ▒▒ ░▓██ ░▒░ ░ ░▒  ░ ░   
 ▒ ░  ░      ░  ░  ░       ░   ▒     ░ ░     ░   ░    ░   ▒   ▒ ▒ ░░  ░  ░  ░     
 ░                 ░           ░  ░    ░  ░    ░          ░  ░░ ░           ░     
                                                              ░ ░                 
▄▄▄█████▓ ██░ ██  ██▀███  ▓█████ ▓█████     ▄▄▄       ███▄ ▄███▓                  
▓  ██▒ ▓▒▓██░ ██▒▓██ ▒ ██▒▓█   ▀ ▓█   ▀    ▒████▄    ▓██▒▀█▀ ██▒                  
▒ ▓██░ ▒░▒██▀▀██░▓██ ░▄█ ▒▒███   ▒███      ▒██  ▀█▄  ▓██    ▓██░                  
░ ▓██▓ ░ ░▓█ ░██ ▒██▀▀█▄  ▒▓█  ▄ ▒▓█  ▄    ░██▄▄▄▄██ ▒██    ▒██                   
  ▒██▒ ░ ░▓█▒░██▓░██▓ ▒██▒░▒████▒░▒████▒    ▓█   ▓██▒▒██▒   ░██▒                  
  ▒ ░░    ▒ ░░▒░▒░ ▒▓ ░▒▓░░░ ▒░ ░░░ ▒░ ░    ▒▒   ▓▒█░░ ▒░   ░  ░                  
    ░     ▒ ░▒░ ░  ░▒ ░ ▒░ ░ ░  ░ ░ ░  ░     ▒   ▒▒ ░░  ░      ░                  
  ░       ░  ░░ ░  ░░   ░    ░      ░        ░   ▒   ░      ░                     
          ░  ░  ░   ░        ░  ░   ░  ░         ░  ░       ░                     
                                                                                  
"@
#endregion

# If we are not using the ocnfig files becuase they take too long even though they are the correct wya to do things
# we dont need this replace inhere
# [version]$dbachecksversioninconfig = (Get-DbcConfigValue -Name app.checkrepos).Split('/')[-1].Split('\')[0]
# [version]$dbachecksmodulevarsion = (Get-Module dbachecks).Version
# 
# if ($dbachecksmodulevarsion -ne $dbachecksversioninconfig) {
#   Get-ChildItem /workspace/Demos/dbachecksconfigs/*.json | ForEach-Object {
#     (Get-Content -Path $_.FullName) -replace $dbachecksversioninconfig, $dbachecksmodulevarsion | Set-Content $_.FullName
#   }
# }
function Start-Game {
  # Because we are using volumes for the restore demo, need to ensure they are clean before starting the game
  Remove-Item '/var/opt/backups/dbatools1' -Recurse -Force -ErrorAction SilentlyContinue
  Clear-Host
  $title = "Joshua Says" 
  $yes = New-Object System.Management.Automation.Host.ChoiceDescription "&Yes", "Will continue" 
  $no = New-Object System.Management.Automation.Host.ChoiceDescription "&No", "Will exit" 
  $options = [System.Management.Automation.Host.ChoiceDescription[]]($yes, $no) 
  $result = $host.ui.PromptForChoice($title, $ShallWePLayAGame, $options, 0) 
  
  if ($result -eq 1) { 
    Clear-Host
    Write-Output $OhNo1
    Start-Sleep -Seconds 1
    Clear-Host
    Start-Sleep -Milliseconds 250
    Write-Output $OhNo2
  }
  elseif ($result -eq 0) { 
    Clear-Host
    Get-Index
  }
}

function Get-Index {
  Clear-Host
  Write-Output $ChooseYourgame
  $gameChapters = @(
    ("&1 - Introduction to dbatools", "1 - Introduction to dbatools"),
    ("&2 - Backup and Restore", "2 - Backup and Restore"),
    ("&3 - Copy Copy Copy", "3 - Copy Copy Copy"),
    ("&4 - SnapShots", "4 - SnapShots"),
    ("&5 - Export", "5 - Export"),
    ("&6 - Availability Groups", "6 - Availability Groups"),
    ("&7 - Finding Things", "7 - Finding Things"),
    ("&8 - Data Masking", "8 - Data Masking"),
    ("&9 - Logins", "9 - Logins"),
    ("&Q - Quit", "Quit")
  )

  $options = New-Object System.Collections.ObjectModel.Collection[System.Management.Automation.Host.ChoiceDescription]

  foreach ($Chapter in $gameChapters) {
    $message = '{0}' -f $chapter[1]
    Write-Output $message
    $options.Add((New-Object System.Management.Automation.Host.ChoiceDescription $Chapter ) ) 
  }
  $title = "Joshua Says" 
  $IndexChoice = $host.ui.PromptForChoice($title, "Make Your Choice", $options, 0) + 1

  switch ($IndexChoice) {
    1 { 
      Clear-Host
      Write-Output "1 - Introduction to dbatools" 
      code /workspace/Demos/01-introduction.ps1
      #reset anbd run tests
      Write-PSFHostColor -String "Just running some tests a mo" -DefaultColor Green
      Assert-Correct -chapter intro
    }
    2 { 
      Clear-Host
      Write-Output "2 - Backup and Restore" 
      code /workspace/Demos/02-BackUpRestore.ps1
      Write-PSFHostColor -String "Just running some tests a mo" -DefaultColor Green
      Assert-Correct -chapter Backup
    }
    3 { 
      Clear-Host
      Write-Output "3 - Copy Copy Copy" 
      code /workspace/Demos/03-CopyCopy.ps1
      Write-PSFHostColor -String "Just running some tests a mo" -DefaultColor Green
      Assert-Correct -chapter Copy
    }
    4 { 
      Clear-Host
      Write-Output "4 - SnapShots" 
      code /workspace/Demos/04-Snapshots.ps1
      Write-PSFHostColor -String "Just running some tests a mo" -DefaultColor Green
      Assert-Correct -chapter SnapShots
    }
    6 { 
      Clear-Host
      Write-Output "6 - Availability Groups" 
      code /workspace/Demos/06-AvailabilityGroups.ps1
      Write-PSFHostColor -String "Just running some tests a mo" -DefaultColor Green
      Assert-Correct -chapter Ags
    }
    5 { 
      Clear-Host
      Write-Output "5 - Export" 
      code /workspace/Demos/05-Export.ps1
      Write-PSFHostColor -String "Just running some tests a mo" -DefaultColor Green
      Assert-Correct -chapter Export
    }
    7 { 
      Clear-Host
      Write-Output "7 - Finding Things" 
      code /workspace/Demos/07-FindingThings.ps1
      Write-PSFHostColor -String "Just running some tests a mo - I'm not - there arent any" -DefaultColor Green
      #Assert-Correct -chapter Export
    }
    8 { 
      Clear-Host
      Write-Output "8 - Data Masking" 
      code /workspace/Demos/08-DataMasking.ps1
      Write-PSFHostColor -String "Just running some tests a mo - I'm not - there arent any" -DefaultColor Green
      #Assert-Correct -chapter Export
    }
    9 { 
      Clear-Host
      Write-Output "9 - Logins" 
      code /workspace/Demos/09-Logins.ps1
      Write-PSFHostColor -String "Just running some tests a mo - I'm not - there arent any" -DefaultColor Green
      #Assert-Correct -chapter Export
    }
    'q' {
      Clear-Host
    }
    Default {
      Clear-Host
      Write-Output $wrongChoice
      Start-Sleep -Seconds 1
      Clear-Host
      Start-Sleep -Milliseconds 250
      Write-Output $OhNo2
      $message = "You chose - {0}" -f $IndexChoice
      Write-Output $message
    }
  }
}

function Set-ConnectionInfo {
  #region Set up connection
  $securePassword = ('dbatools.IO' | ConvertTo-SecureString -asPlainText -Force)
  $continercredential = New-Object System.Management.Automation.PSCredential('sqladmin', $securePassword)

  $Global:PSDefaultParameterValues = @{
    "*dba*:SqlCredential"            = $continercredential
    "*dba*:SourceSqlCredential"      = $continercredential
    "*dba*:DestinationSqlCredential" = $continercredential
    "*dba*:PrimarySqlCredential"     = $continercredential
    "*dba*:SecondarySqlCredential"   = $continercredential
  }


  $containers = $SQLInstances = $dbatools1, $dbatools2 = 'dbatools1', 'dbatools2'
  #endregion
}

Set-ConnectionInfo
function Assert-Correct {
  param (
    # Parameter help description
    [Parameter()]
    [ValidateSet(
      'initial',
      'Intro' ,
      'Backup',
      'Copy',
      'SnapShots',
      'Export',
      'Ags'
    )]
    [string]
    $chapter = 'initial'
  )
  $Global:PSDefaultParameterValues.CLear()
  switch ($chapter) {
    'initial' { 
      # Valid estate is as we expect

      $null = Reset-DbcConfig 

      Set-DbcConfig -Name app.sqlinstance -Value $containers
      Set-DbcConfig -Name policy.connection.authscheme -Value 'SQL'
      Set-DbcConfig -Name skip.connection.remoting -Value $true
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection -Verbose

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools2'
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools1'
      Set-DbcConfig -Name database.exists -Value 'pubs', 'NorthWind' -Append
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists
    }
    'Intro' { 
      # Valid estate is as we expect

      $null = Reset-DbcConfig 

      Set-DbcConfig -Name app.sqlinstance -Value $containers
      Set-DbcConfig -Name policy.connection.authscheme -Value 'SQL'
      Set-DbcConfig -Name skip.connection.remoting -Value $true
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection -Verbose

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools2'
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools1'
      Set-DbcConfig -Name database.exists -Value 'pubs', 'NorthWind' -Append
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists
    }
    'Backup' { 
      # Valid estate is as we expect

      $null = Reset-DbcConfig 
      Set-DbcConfig -Name app.checkrepos -Value '/workspace/Demos/dbachecksconfigs' -Append
      Set-DbcConfig -Name app.sqlinstance -Value $containers | Out-Null
      Set-DbcConfig -Name policy.connection.authscheme -Value 'SQL' | Out-Null
      Set-DbcConfig -Name skip.connection.remoting -Value $true | Out-Null

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools2' | Out-Null

      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection, DatabaseExists

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools1' | Out-Null
      Set-DbcConfig -Name database.exists -Value 'master', 'model', 'msdb', 'Northwind', 'pubs', 'tempdb' | Out-Null
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection, DatabaseExists, NoDatabasesOn1,NoBackupFiles
    }
    'Copy' { 
      # Valid estate is as we expect

      $null = Reset-DbcConfig 
      Set-DbcConfig -Name app.checkrepos -Value '/workspace/Demos/dbachecksconfigs' -Append
      Set-DbcConfig -Name app.sqlinstance -Value $containers  | Out-Null
      Set-DbcConfig -Name policy.connection.authscheme -Value 'SQL'  | Out-Null
      Set-DbcConfig -Name skip.connection.remoting -Value $true  | Out-Null
      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools2' | Out-Null
      Set-DbcConfig -Name database.exists -Value 'master', 'model', 'msdb', 'tempdb' | Out-Null

      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection, DatabaseExists, NoDatabasesOn2

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools1' | Out-Null
      Set-DbcConfig -Name database.exists -Value 'master', 'model', 'msdb', 'Northwind', 'pubs', 'pubs-0', 'pubs-1', 'pubs-10', 'pubs-2', 'pubs-3', 'pubs-4', 'pubs-5', 'pubs-6', 'pubs-7', 'pubs-8', 'pubs-9', 'tempdb' | Out-Null
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection, DatabaseExists
    }
    'Snapshots' { 
      # Valid estate is as we expect
      Write-PSFHostColor -String "Running the SnapShot Chapter checks" -DefaultColor Green
      $null = Reset-DbcConfig 
      Set-DbcConfig -Name app.checkrepos -Value '/workspace/Demos/dbachecksconfigs' -Append | Out-Null
      Set-DbcConfig -Name app.sqlinstance -Value $containers  | Out-Null
      Set-DbcConfig -Name policy.connection.authscheme -Value 'SQL'  | Out-Null
      Set-DbcConfig -Name skip.connection.remoting -Value $true  | Out-Null
      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools2' | Out-Null
      Set-DbcConfig -Name database.exists -Value 'master', 'model', 'msdb', 'tempdb' | Out-Null

      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection, DatabaseExists, NoDatabases, DatabaseStatus, NoSnapshots

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools1' | Out-Null
      Set-DbcConfig -Name database.exists -Value 'master', 'model', 'msdb', 'Northwind', 'pubs', 'pubs-0', 'pubs-1', 'pubs-10', 'pubs-2', 'pubs-3', 'pubs-4', 'pubs-5', 'pubs-6', 'pubs-7', 'pubs-8', 'pubs-9', 'tempdb' | Out-Null
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection, DatabaseExists, DatabaseStatus
    }
    'Export' { 
      # Valid estate is as we expect

      $null = Reset-DbcConfig 

      Set-DbcConfig -Name app.sqlinstance -Value $containers
      Set-DbcConfig -Name policy.connection.authscheme -Value 'SQL'
      Set-DbcConfig -Name skip.connection.remoting -Value $true
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection -Verbose

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools2'
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools1'
      Set-DbcConfig -Name database.exists -Value 'pubs', 'NorthWind' -Append
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists
    }
    'Ags' { 
      # Valid estate is as we expect

      $null = Reset-DbcConfig 

      Set-DbcConfig -Name app.sqlinstance -Value $containers
      Set-DbcConfig -Name policy.connection.authscheme -Value 'SQL'
      Set-DbcConfig -Name skip.connection.remoting -Value $true
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection -Verbose

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools2' | Out-Null
      Set-DbcConfig -Name database.exists -Value 'master', 'model', 'msdb', 'tempdb' | Out-Null

      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection, DatabaseExists, NoDatabases, DatabaseStatus, NoSnapshots, NoAgs

      Set-DbcConfig -Name app.sqlinstance -Value 'dbatools1' | Out-Null
      Set-DbcConfig -Name database.exists -Value 'master', 'model', 'msdb', 'Northwind', 'pubs', 'pubs-0', 'pubs-1', 'pubs-10', 'pubs-2', 'pubs-3', 'pubs-4', 'pubs-5', 'pubs-6', 'pubs-7', 'pubs-8', 'pubs-9', 'tempdb' | Out-Null
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection, DatabaseExists, DatabaseStatus

      Write-PSFHostColor -String "If you get database missing failures - Chapter 2 will be your friend" -DefaultColor Magenta
    }
    Default {
      # Valid estate is as we expect

      $null = Reset-DbcConfig 

      $null = Import-DbcConfig /workspace/Demos/dbachecksconfigs/initial-config.json
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection 

      $null = Reset-DbcConfig 

      $null = Import-DbcConfig /workspace/Demos/dbachecksconfigs/initial-dbatools1-config.json
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists

      $null = Reset-DbcConfig 

      $null = Import-DbcConfig /workspace/Demos/dbachecksconfigs/initial-dbatools2-config.json
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists
    }
  }
  $Global:PSDefaultParameterValues = @{
    "*dba*:SqlCredential"            = $continercredential
    "*dba*:SourceSqlCredential"      = $continercredential
    "*dba*:DestinationSqlCredential" = $continercredential
    "*dba*:PrimarySqlCredential"     = $continercredential
    "*dba*:SecondarySqlCredential"   = $continercredential
  }
}

Function Compare-SPConfig {

  Param(
    $Source,
    $Destination
  )
  $SourceSpConfigure = Get-DbaSpConfigure  -SqlInstance $Source
  $DestSPConfigure = Get-DbaSpConfigure -SqlInstance $Destination

  $propcompare = foreach ($prop in $SourceSpConfigure) {
    [pscustomobject]@{
      Config                = $prop.DisplayName
      'Source setting'      = $prop.RunningValue
      'Destination Setting' = $DestSPConfigure | Where DisplayName -eq $prop.DisplayName | Select -ExpandProperty RunningValue
    }
  } 

  if ($IsCoreCLR) {
    $propcompare | Out-ConsoleGridView -Title "Comparing Sp_configure Settings Source - $Source With Destination $Destination"
  }
  else {
    $propcompare | Out-GridView -Title "Comparing Sp_configure Settings Source - $SourceWith Destination $Destination"

  }


}

Set-PSFConfig -Module JessAndBeard -Name shallweplayagame -Value $false -Initialize -Description "Whether to ask or not" -ModuleExport 