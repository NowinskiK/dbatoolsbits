#region words
$ShallWePLayAGame = @"

  _____ _           _ _  __          __    _____  _                           _____                     ___  
 / ____| |         | | | \ \        / /   |  __ \| |                 /\      / ____|                   |__ \ 
| (___ | |__   __ _| | |  \ \  /\  / /__  | |__) | | __ _ _   _     /  \    | |  __  __ _ _ __ ___   ___  ) |
 \___ \| '_ \ / _` | | |   \ \/  \/ / _ \ |  ___/| |/ _` | | | |   / /\ \   | | |_ |/ _` | '_ ` _ \ / _ \/ / 
 ____) | | | | (_| | | |    \  /\  /  __/ | |    | | (_| | |_| |  / ____ \  | |__| | (_| | | | | | |  __/_|  
|_____/|_| |_|\__,_|_|_|     \/  \/ \___| |_|    |_|\__,_|\__, | /_/    \_\  \_____|\__,_|_| |_| |_|\___(_)  
                                                           __/ |                                             
                                                          |___/                                              
"@
#ANSI Shadow https://patorjk.com/software/taag/#p=testall&f=Doom&t=Shall%20We%20Play%20A%20Game%3F
$ShallWePLayAGame = @"

 ███████╗██╗  ██╗ █████╗ ██╗     ██╗         ██╗    ██╗███████╗    ██████╗ ██╗      █████╗ ██╗   ██╗     █████╗      ██████╗  █████╗ ███╗   ███╗███████╗██████╗ 
 ██╔════╝██║  ██║██╔══██╗██║     ██║         ██║    ██║██╔════╝    ██╔══██╗██║     ██╔══██╗╚██╗ ██╔╝    ██╔══██╗    ██╔════╝ ██╔══██╗████╗ ████║██╔════╝╚════██╗
 ███████╗███████║███████║██║     ██║         ██║ █╗ ██║█████╗      ██████╔╝██║     ███████║ ╚████╔╝     ███████║    ██║  ███╗███████║██╔████╔██║█████╗    ▄███╔╝
 ╚════██║██╔══██║██╔══██║██║     ██║         ██║███╗██║██╔══╝      ██╔═══╝ ██║     ██╔══██║  ╚██╔╝      ██╔══██║    ██║   ██║██╔══██║██║╚██╔╝██║██╔══╝    ▀▀══╝ 
 ███████║██║  ██║██║  ██║███████╗███████╗    ╚███╔███╔╝███████╗    ██║     ███████╗██║  ██║   ██║       ██║  ██║    ╚██████╔╝██║  ██║██║ ╚═╝ ██║███████╗  ██╗   
 ╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝╚══════╝     ╚══╝╚══╝ ╚══════╝    ╚═╝     ╚══════╝╚═╝  ╚═╝   ╚═╝       ╚═╝  ╚═╝     ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝╚══════╝  ╚═╝   
                                                                                                                                                                
 
"@

$OhNo1 = @"
██████  ██░ ██  ▄▄▄       ██▓     ██▓        █     █░▓█████     ██▓███   ██▓    ▄▄▄     ▓██   ██▓    ▄▄▄           ▄████  ▄▄▄       ███▄ ▄███▓▓█████ 
▒██    ▒ ▓██░ ██▒▒████▄    ▓██▒    ▓██▒       ▓█░ █ ░█░▓█   ▀    ▓██░  ██▒▓██▒   ▒████▄    ▒██  ██▒   ▒████▄        ██▒ ▀█▒▒████▄    ▓██▒▀█▀ ██▒▓█   ▀ 
░ ▓██▄   ▒██▀▀██░▒██  ▀█▄  ▒██░    ▒██░       ▒█░ █ ░█ ▒███      ▓██░ ██▓▒▒██░   ▒██  ▀█▄   ▒██ ██░   ▒██  ▀█▄     ▒██░▄▄▄░▒██  ▀█▄  ▓██    ▓██░▒███   
  ▒   ██▒░▓█ ░██ ░██▄▄▄▄██ ▒██░    ▒██░       ░█░ █ ░█ ▒▓█  ▄    ▒██▄█▓▒ ▒▒██░   ░██▄▄▄▄██  ░ ▐██▓░   ░██▄▄▄▄██    ░▓█  ██▓░██▄▄▄▄██ ▒██    ▒██ ▒▓█  ▄ 
▒██████▒▒░▓█▒░██▓ ▓█   ▓██▒░██████▒░██████▒   ░░██▒██▓ ░▒████▒   ▒██▒ ░  ░░██████▒▓█   ▓██▒ ░ ██▒▓░    ▓█   ▓██▒   ░▒▓███▀▒ ▓█   ▓██▒▒██▒   ░██▒░▒████▒
▒ ▒▓▒ ▒ ░ ▒ ░░▒░▒ ▒▒   ▓▒█░░ ▒░▓  ░░ ▒░▓  ░   ░ ▓░▒ ▒  ░░ ▒░ ░   ▒▓▒░ ░  ░░ ▒░▓  ░▒▒   ▓▒█░  ██▒▒▒     ▒▒   ▓▒█░    ░▒   ▒  ▒▒   ▓▒█░░ ▒░   ░  ░░░ ▒░ ░
░ ░▒  ░ ░ ▒ ░▒░ ░  ▒   ▒▒ ░░ ░ ▒  ░░ ░ ▒  ░     ▒ ░ ░   ░ ░  ░   ░▒ ░     ░ ░ ▒  ░ ▒   ▒▒ ░▓██ ░▒░      ▒   ▒▒ ░     ░   ░   ▒   ▒▒ ░░  ░      ░ ░ ░  ░
░  ░  ░   ░  ░░ ░  ░   ▒     ░ ░     ░ ░        ░   ░     ░      ░░         ░ ░    ░   ▒   ▒ ▒ ░░       ░   ▒      ░ ░   ░   ░   ▒   ░      ░      ░   
      ░   ░  ░  ░      ░  ░    ░  ░    ░  ░       ░       ░  ░                ░  ░     ░  ░░ ░              ░  ░         ░       ░  ░       ░      ░  ░
                                                                                           ░ ░                                                         
"@

$OhNo2 = @"

▄████  ▒█████   ▒█████  ▓█████▄     ▄▄▄▄ ▓██   ██▓▓█████ 
██▒ ▀█▒▒██▒  ██▒▒██▒  ██▒▒██▀ ██▌   ▓█████▄▒██  ██▒▓█   ▀ 
▒██░▄▄▄░▒██░  ██▒▒██░  ██▒░██   █▌   ▒██▒ ▄██▒██ ██░▒███   
░▓█  ██▓▒██   ██░▒██   ██░░▓█▄   ▌   ▒██░█▀  ░ ▐██▓░▒▓█  ▄ 
░▒▓███▀▒░ ████▓▒░░ ████▓▒░░▒████▓    ░▓█  ▀█▓░ ██▒▓░░▒████▒
░▒   ▒ ░ ▒░▒░▒░ ░ ▒░▒░▒░  ▒▒▓  ▒    ░▒▓███▀▒ ██▒▒▒ ░░ ▒░ ░
 ░   ░   ░ ▒ ▒░   ░ ▒ ▒░  ░ ▒  ▒    ▒░▒   ░▓██ ░▒░  ░ ░  ░
░ ░   ░ ░ ░ ░ ▒  ░ ░ ░ ▒   ░ ░  ░     ░    ░▒ ▒ ░░     ░   
     ░     ░ ░      ░ ░     ░        ░     ░ ░        ░  ░
                          ░               ░░ ░            
▄▄▄█████▓ ██░ ██ ▓█████    ▓█████  ███▄    █ ▓█████▄       
▓  ██▒ ▓▒▓██░ ██▒▓█   ▀    ▓█   ▀  ██ ▀█   █ ▒██▀ ██▌      
▒ ▓██░ ▒░▒██▀▀██░▒███      ▒███   ▓██  ▀█ ██▒░██   █▌      
░ ▓██▓ ░ ░▓█ ░██ ▒▓█  ▄    ▒▓█  ▄ ▓██▒  ▐▌██▒░▓█▄   ▌      
 ▒██▒ ░ ░▓█▒░██▓░▒████▒   ░▒████▒▒██░   ▓██░░▒████▓       
 ▒ ░░    ▒ ░░▒░▒░░ ▒░ ░   ░░ ▒░ ░░ ▒░   ▒ ▒  ▒▒▓  ▒       
   ░     ▒ ░▒░ ░ ░ ░  ░    ░ ░  ░░ ░░   ░ ▒░ ░ ▒  ▒       
 ░       ░  ░░ ░   ░         ░      ░   ░ ░  ░ ░  ░       
         ░  ░  ░   ░  ░      ░  ░         ░    ░          
                                             ░            

"@
$ChooseYourgame = @"

██████ ██   ██  ██████   ██████  ███████ ███████     ██    ██  ██████  ██    ██ ██████       ██████   █████  ███    ███ ███████              
██      ██   ██ ██    ██ ██    ██ ██      ██           ██  ██  ██    ██ ██    ██ ██   ██     ██       ██   ██ ████  ████ ██          ██       
██      ███████ ██    ██ ██    ██ ███████ █████         ████   ██    ██ ██    ██ ██████      ██   ███ ███████ ██ ████ ██ █████          █████ 
██      ██   ██ ██    ██ ██    ██      ██ ██             ██    ██    ██ ██    ██ ██   ██     ██    ██ ██   ██ ██  ██  ██ ██          ██       
 ██████ ██   ██  ██████   ██████  ███████ ███████        ██     ██████   ██████  ██   ██      ██████  ██   ██ ██      ██ ███████              
"@
$wrongChoice = @"

█     █░ ██▀███   ▒█████   ███▄    █   ▄████ 
▓█░ █ ░█░▓██ ▒ ██▒▒██▒  ██▒ ██ ▀█   █  ██▒ ▀█▒
▒█░ █ ░█ ▓██ ░▄█ ▒▒██░  ██▒▓██  ▀█ ██▒▒██░▄▄▄░
░█░ █ ░█ ▒██▀▀█▄  ▒██   ██░▓██▒  ▐▌██▒░▓█  ██▓
░░██▒██▓ ░██▓ ▒██▒░ ████▓▒░▒██░   ▓██░░▒▓███▀▒
░ ▓░▒ ▒  ░ ▒▓ ░▒▓░░ ▒░▒░▒░ ░ ▒░   ▒ ▒  ░▒   ▒ 
  ▒ ░ ░    ░▒ ░ ▒░  ░ ▒ ▒░ ░ ░░   ░ ▒░  ░   ░ 
  ░   ░    ░░   ░ ░ ░ ░ ▒     ░   ░ ░ ░ ░   ░ 
    ░       ░         ░ ░           ░       ░ 
                                              
 ▄████▄   ██░ ██  ▒█████   ██▓ ▄████▄  ▓█████ 
▒██▀ ▀█  ▓██░ ██▒▒██▒  ██▒▓██▒▒██▀ ▀█  ▓█   ▀ 
▒▓█    ▄ ▒██▀▀██░▒██░  ██▒▒██▒▒▓█    ▄ ▒███   
▒▓▓▄ ▄██▒░▓█ ░██ ▒██   ██░░██░▒▓▓▄ ▄██▒▒▓█  ▄ 
▒ ▓███▀ ░░▓█▒░██▓░ ████▓▒░░██░▒ ▓███▀ ░░▒████▒
░ ░▒ ▒  ░ ▒ ░░▒░▒░ ▒░▒░▒░ ░▓  ░ ░▒ ▒  ░░░ ▒░ ░
  ░  ▒    ▒ ░▒░ ░  ░ ▒ ▒░  ▒ ░  ░  ▒    ░ ░  ░
░         ░  ░░ ░░ ░ ░ ▒   ▒ ░░           ░   
░ ░       ░  ░  ░    ░ ░   ░  ░ ░         ░  ░
░                             ░               
"@
#endregion
function Start-Game {
  Clear-Host
  $title = "Joshua Says" 
  $yes = New-Object System.Management.Automation.Host.ChoiceDescription "&Yes", "Will continue" 
  $no = New-Object System.Management.Automation.Host.ChoiceDescription "&No", "Will exit" 
  $options = [System.Management.Automation.Host.ChoiceDescription[]]($yes, $no) 
  $result = $host.ui.PromptForChoice($title, $ShallWePLayAGame, $options, 0) 
  
  if ($result -eq 1) { 
    Clear-Host
    Write-Output $OhNo1
    Start-Sleep -Seconds 1
    Clear-Host
    Start-Sleep -Milliseconds 250
    Write-Output $OhNo2
  }
  elseif ($result -eq 0) { 
    Clear-Host
    Get-Index
  }
}

function Get-Index {
  Clear-Host
  Write-Output $ChooseYourgame
  Write-Output "1 - Introduction to dbatools"
  Write-Output "2 - Backup and Restore"
  Write-Output "3 - Copy Copy Copy"
  $title = "Joshua Says" 
  $Intro = New-Object System.Management.Automation.Host.ChoiceDescription "&1", "Intro" 
  $Backup = New-Object System.Management.Automation.Host.ChoiceDescription "&2", "Backup" 
  $Copy = New-Object System.Management.Automation.Host.ChoiceDescription "&3", "Copy" 
  $options = [System.Management.Automation.Host.ChoiceDescription[]]($Intro, $Backup, $Copy) 
  $IndexChoice = $host.ui.PromptForChoice($title, "Make Your Choice", $options, 0) + 1

  switch ($IndexChoice) {
    1 { 
      Clear-Host
      Write-Output "1 - Introduction to dbatools" 
      code /workspace/Demos/01-introduction.ps1
      #reset anbd run tests
    }
    2 { 
      Clear-Host
      Write-Output "2 - Backup and Restore" 
      code /workspace/Demos/02-BackUpRestore.ps1
    }
    3 { 
      Clear-Host
      Write-Output "3 - Copy Copy Copy" 
      code /workspace/Demos/03-CopyCopy.ps1
    }
    Default {
      Clear-Host
      Write-Output $wrongChoice
      Start-Sleep -Seconds 1
      Clear-Host
      Start-Sleep -Milliseconds 250
      Write-Output $OhNo2
      $message = "You chose - {0}" -f $IndexChoice
      Write-Output $message
    }
  }
}

function Set-ConnectionInfo {
  #region Set up connection
  $securePassword = ('dbatools.IO' | ConvertTo-SecureString -asPlainText -Force)
  $continercredential = New-Object System.Management.Automation.PSCredential('sqladmin', $securePassword)

  $PSDefaultParameterValues = @{
    "*dba*:SqlCredential"            = $continercredential
    "*dba*:SourceSqlCredential"      = $continercredential
    "*dba*:DestinationSqlCredential" = $continercredential
    "*dba*:PrimarySqlCredential"     = $continercredential
    "*dba*:SecondarySqlCredential"   = $continercredential
  }


  $containers = $SQLInstances = $dbatools1, $dbatools2 = 'dbatools1', 'dbatools2'
  #endregion
}

function Assert-Correct {
  param (
    # Parameter help description
    [Parameter()]
    [ValidateSet(
      'initial',
      'Intro' ,
      'Backup',
      'Copy',
      'SnapShots',
      'Export'
    )]
    [string]
    $chapter = 'initial'
  )
  switch ($chapter) {
    'initial' { 
      # Valid estate is as we expect

      $null = Reset-DbcConfig 

      $null = Import-DbcConfig /workspace/Demos/dbachecksconfigs/initial-config.json
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection -Verbose

      $null = Reset-DbcConfig 

      $null = Import-DbcConfig /workspace/Demos/dbachecksconfigs/initial-dbatools1-config.json
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists

      $null = Reset-DbcConfig 

      $null = Import-DbcConfig /workspace/Demos/dbachecksconfigs/initial-dbatools2-config.json
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists
    }
    Default {
      # Valid estate is as we expect

      $null = Reset-DbcConfig 

      $null = Import-DbcConfig /workspace/Demos/dbachecksconfigs/initial-config.json
      Invoke-DbcCheck -SqlCredential $continercredential -Check InstanceConnection 

      $null = Reset-DbcConfig 

      $null = Import-DbcConfig /workspace/Demos/dbachecksconfigs/initial-dbatools1-config.json
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists

      $null = Reset-DbcConfig 

      $null = Import-DbcConfig /workspace/Demos/dbachecksconfigs/initial-dbatools2-config.json
      Invoke-DbcCheck -SqlCredential $continercredential -Check DatabaseExists
    }
  }
}

Set-PSFConfig -Module JessAndBeard -Name shallweplayagame -Value $true -Initialize -Description "Whether to ask or not" -ModuleExport 